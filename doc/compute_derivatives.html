<HTML>
<HEAD>
   <TITLE> module compute_derivatives (generated by f90doc) </TITLE>
</HEAD>
<H1> Module compute_derivatives </H1>
<PRE>module compute_derivatives

        ! Uses
    use <A HREF="parameters_io.html">parameters_IO</A>
    use <A HREF="fft_engine.html">fft_engine</A>
    use <A HREF="decomp_2d.html">decomp_2d</A>
    use <A HREF="decomp_2d_custom.html">decomp_2d_custom</A>
    use <A HREF="decomp_2d_fft_2d.html">decomp_2d_fft_2d</A>

        ! Variables
    real (kind=rprec), private, allocatable, dimension(:,:,:) :: <A HREF="compute_derivatives.html#var_wk1_4y">wk1_4y</A>
    real (kind=rprec), private, allocatable, dimension(:,:,:) :: <A HREF="compute_derivatives.html#var_wk2_4y">wk2_4y</A>
    type (DECOMP_INFO), private, save :: <A HREF="compute_derivatives.html#var_dcp">dcp</A>
    type (DECOMP_INFO), private, save :: <A HREF="compute_derivatives.html#var_dcpg">dcpg</A>
    type (DECOMP_INFO), private, save :: <A HREF="compute_derivatives.html#var_sp">sp</A>

        ! Subroutines and functions
    public subroutine <A HREF="compute_derivatives.html#subroutine_deriv_init">deriv_init</A> (dcp_main, dcp_ghost)
    public subroutine <A HREF="compute_derivatives.html#subroutine_deriv_finalize">deriv_finalize</A> ()
    public subroutine <A HREF="compute_derivatives.html#subroutine_grad_velocity_filt">grad_velocity_filt</A> (f, dfdx, dfdy)
    private subroutine <A HREF="compute_derivatives.html#subroutine_grad_velocity_filt1d">grad_velocity_filt1d</A> (f, dfdx, dfdy)
    private subroutine <A HREF="compute_derivatives.html#subroutine_compute_filt_dfdx">compute_filt_dfdx</A> (f, dfdx)
    private subroutine <A HREF="compute_derivatives.html#subroutine_compute_filt_dfdy">compute_filt_dfdy</A> (f, dfdy)
    public subroutine <A HREF="compute_derivatives.html#subroutine_ddx">ddx</A> (dfdx, f)
    public subroutine <A HREF="compute_derivatives.html#subroutine_ddy">ddy</A> (dfdy, f)
    public subroutine <A HREF="compute_derivatives.html#subroutine_ddz_uv">ddz_uv</A> (dfdz, f)
    public subroutine <A HREF="compute_derivatives.html#subroutine_ddz_w">ddz_w</A> (dfdz, f)
    public subroutine <A HREF="compute_derivatives.html#subroutine_div_stress">div_stress</A> (rhs, tx, ty, tz, stag, bottom_wk_press, top_wk_press)

end module compute_derivatives
</PRE>
  module: compute derivatives (gradients and divergences)
<P>
 <UL>
 <LI>  fabien margairaz (fabien.margairaz@gmail.com)
<P>
 <LI>  description:
 </UL>

<HR><H2> Description of Variables </H2>
<A NAME="var_wk1_4y"><H3>wk1_4y</H3></A>
<PRE>real (kind=rprec), private, allocatable, dimension(:,:,:) :: wk1_4y
</PRE>
 <UL>
 <LI>  workspace for y-transposed variables
 </UL>
<A NAME="var_wk2_4y"><H3>wk2_4y</H3></A>
<PRE>real (kind=rprec), private, allocatable, dimension(:,:,:) :: wk2_4y
</PRE>
 <UL>
 <LI>  workspace for y-transposed variables
 </UL>
<A NAME="var_dcp"><H3>dcp</H3></A>
<PRE>type (DECOMP_INFO), private, save :: dcp
</PRE>
<A NAME="var_dcpg"><H3>dcpg</H3></A>
<PRE>type (DECOMP_INFO), private, save :: dcpg
</PRE>
<A NAME="var_sp"><H3>sp</H3></A>
<PRE>type (DECOMP_INFO), private, save :: sp
</PRE>

<HR><H2> Description of Subroutines and Functions </H2>
<A NAME="subroutine_deriv_init"><H3>deriv_init</H3></A>
<PRE>public subroutine deriv_init (dcp_main, dcp_ghost)
    type (DECOMP_INFO), intent(in) :: dcp_main
    type (DECOMP_INFO), intent(in) :: dcp_ghost
    ! Calls: decomp_2d_abort, decomp_2d_fft_2d_get_sp_info
end subroutine deriv_init
</PRE>
 subroutine: initialise derivatives module
<P>
 <UL>
 <LI>  fabien margairaz (fabien.margairaz@gmail.com)
<P>
 <LI>  description:
 </UL>
<A NAME="subroutine_deriv_finalize"><H3>deriv_finalize</H3></A>
<PRE>public subroutine deriv_finalize ()
end subroutine deriv_finalize
</PRE>
 subroutine: finalise derivatives module
<A NAME="subroutine_grad_velocity_filt"><H3>grad_velocity_filt</H3></A>
<PRE>public subroutine grad_velocity_filt (f, dfdx, dfdy)
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(INOUT) :: f
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(INOUT) :: dfdx
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(INOUT) :: dfdy
    ! Calls: execute_decomp_2d_fft_2d
end subroutine grad_velocity_filt
</PRE>
 subroutine: compute flistered gradients in x&y
<P>
 <UL>
 <LI>  fabien margairaz (fabien.margairaz@gmail.com)
<P>
 <LI>  description:
 </UL>
<A NAME="subroutine_grad_velocity_filt1d"><H3>grad_velocity_filt1d</H3></A>
<PRE>private subroutine grad_velocity_filt1d (f, dfdx, dfdy)
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(INOUT) :: f
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(INOUT) :: dfdx
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(INOUT) :: dfdy
    ! Calls: compute_filt_dfdx, compute_filt_dfdy, transpose_x_to_y, transpose_y_to_x
end subroutine grad_velocity_filt1d
</PRE>
 subroutine: compute flistered gradients in x&y
<P>
 <UL>
 <LI>  fabien margairaz (fabien.margairaz@gmail.com)
<P>
 <LI>  description:
 </UL>
<A NAME="subroutine_compute_filt_dfdx"><H3>compute_filt_dfdx</H3></A>
<PRE>private subroutine compute_filt_dfdx (f, dfdx)
    real (kind=rprec), dimension(nx), intent(inout) :: f
    real (kind=rprec), dimension(nx), intent(inout) :: dfdx
    ! Calls: dfftw_execute_dft_c2r, dfftw_execute_dft_r2c
end subroutine compute_filt_dfdx
</PRE>
 subroutine: compute filtered dfdx
<P>
 <UL>
 <LI>  fabien margairaz (fabien.margairaz@gmail.com)
<P>
 <LI>  description:
 </UL>
<A NAME="subroutine_compute_filt_dfdy"><H3>compute_filt_dfdy</H3></A>
<PRE>private subroutine compute_filt_dfdy (f, dfdy)
    real (kind=rprec), dimension(ny), intent(inout) :: f
    real (kind=rprec), dimension(ny), intent(inout) :: dfdy
    ! Calls: dfftw_execute_dft_c2r, dfftw_execute_dft_r2c
end subroutine compute_filt_dfdy
</PRE>
 subroutine: compute filtered dfdy
<P>
 <UL>
 <LI>  fabien margairaz (fabien.margairaz@gmail.com)
<P>
 <LI>  description:
 </UL>
<A NAME="subroutine_ddx"><H3>ddx</H3></A>
<PRE>public subroutine ddx (dfdx, f)
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(out) :: dfdx
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(in) :: f
    ! Calls: dfftw_execute_dft_c2r, dfftw_execute_dft_r2c
end subroutine ddx
</PRE>
 subroutine: compute derivative in x
<P>
 <UL>
 <LI>  fabien margairaz (fabien.margairaz@gmail.com)
<P>
 <LI>  description:
  <UL>
  <LI>  compute the derivatives on a line along x
  <LI>  this subroutine performs differentiation along the given direction adopting 
  an out of place transform.
  <LI>  remember that the input of c2r is anyway destroyed (scr)
 </UL>
  </UL>
<A NAME="subroutine_ddy"><H3>ddy</H3></A>
<PRE>public subroutine ddy (dfdy, f)
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(out) :: dfdy
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(in) :: f
    ! Calls: dfftw_execute_dft_c2r, dfftw_execute_dft_r2c, transpose_x_to_y, transpose_y_to_x
end subroutine ddy
</PRE>
 subroutine: compute derivative in y
<P>
 <UL>
 <LI>  fabien margairaz (fabien.margairaz@gmail.com)
<P>
 <LI>  description:
  <UL>
  <LI>  compute the derivatives on a line along x
  <LI>  this subroutine performs differentiation along the given direction adopting 
  an out of place transform.
  <LI>  remember that the input of c2r is anyway destroyed (scr)
 </UL>
  </UL>
<A NAME="subroutine_ddz_uv"><H3>ddz_uv</H3></A>
<PRE>public subroutine ddz_uv (dfdz, f)
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(out) :: dfdz
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(in) :: f
end subroutine ddz_uv
</PRE>
 subroutine: compute derivative in z for uvp nodes
<P>
 <UL>
 <LI>  fabien margairaz (fabien.margairaz@gmail.com)
<P>
 <LI>  description:
  <UL>
  <LI>  input on uvp-nodes output on w-nodes
 </UL>
  </UL>
<A NAME="subroutine_ddz_w"><H3>ddz_w</H3></A>
<PRE>public subroutine ddz_w (dfdz, f)
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(out) :: dfdz
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(in) :: f
end subroutine ddz_w
</PRE>
 subroutine: compute derivative in z for w nodes
<P>
 <UL>
 <LI>  fabien margairaz (fabien.margairaz@gmail.com)
<P>
 <LI>  description:
  <UL>
  <LI>  input on w-nodes output on uvp-nodes
 </UL>
  </UL>
<A NAME="subroutine_div_stress"><H3>div_stress</H3></A>
<PRE>public subroutine div_stress (rhs, tx, ty, tz, stag, bottom_wk_press, top_wk_press)
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(inout) :: rhs
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(in) :: tx
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(in) :: ty
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(in) :: tz
    logical, intent(in) :: stag
    real (kind=rprec), optional, dimension(dcp%xsz(1),dcp%xsz(2)), intent(out) :: bottom_wk_press
    real (kind=rprec), optional, dimension(dcp%xsz(1),dcp%xsz(2)), intent(out) :: top_wk_press
    ! Calls: ddz_uv, ddz_w, execute_decomp_2d_fft_2d
end subroutine div_stress
</PRE>
 subroutine: compute divergence of stress
<P>
 <UL>
 <LI>  marco giometto ( mgiometto@gmail.com )
 <LI>  fabien margairaz (fabien.margairaz@gmail.com)
<P>
 <LI>  description:
  <UL>
  <LI>  add the divergence of stress to rhs
  <LI>  provides divt, jz=1:nz-1
  <LI>  stag=.true. for uvp nodes
  <LI>  stag=.false. for w nodes
<P>
  </UL>
 <LI>  notes: 
  <UL>
  <LI>  this way could parallelize this 3 derivative calculation at the
    price of a little more memory, alternative use a scr for dtxdx
    etc and update directly the rhs
  <LI>  we compute the stress divergence from 1 to nz-1 since for uvp
    the nz level is outside and since we prescribe a bc for w(nz)
 </UL>
  </UL>
</HTML>
