<HTML>
<HEAD>
   <TITLE> module compute_pressure (generated by f90doc) </TITLE>
</HEAD>
<H1> Module compute_pressure </H1>
<PRE>module compute_pressure

        ! Uses
    use <A HREF="parameters_io.html">parameters_IO</A>
    use <A HREF="decomp_2d.html">decomp_2d</A>
    use <A HREF="decomp_2d_custom.html">decomp_2d_custom</A>
    use <A HREF="decomp_2d_fft_2d.html">decomp_2d_fft_2d</A>
    use <A HREF="fft_engine.html">fft_engine</A>
    use <A HREF="utility_tools.html">utility_tools</A>
    use <A HREF="system_variables.html">system_variables</A>, only : u,v,w,p,dpdx,dpdy,dpdz,bottom_wk_press,top_wk_press

        ! Variables
    type (DECOMP_INFO), private, save :: <A HREF="compute_pressure.html#var_dcp">dcp</A>
    type (DECOMP_INFO), private, save :: <A HREF="compute_pressure.html#var_sp">sp</A>
    real (kind=rprec), private, allocatable, dimension(:,:,:) :: <A HREF="compute_pressure.html#var_a">a</A>
    real (kind=rprec), private, allocatable, dimension(:,:,:) :: <A HREF="compute_pressure.html#var_b">b</A>
    real (kind=rprec), private, allocatable, dimension(:,:,:) :: <A HREF="compute_pressure.html#var_c">c</A>

        ! Subroutines and functions
    public subroutine <A HREF="compute_pressure.html#subroutine_press_init">press_init</A> (dcp_main)
    public subroutine <A HREF="compute_pressure.html#subroutine_press_finalize">press_finalize</A> ()
    public subroutine <A HREF="compute_pressure.html#subroutine_press_stag_array">press_stag_array</A> (tadv1)
    private subroutine <A HREF="compute_pressure.html#subroutine_poisson_solver">poisson_solver</A> (wk_press, bot_layer, top_layer)
    private subroutine <A HREF="compute_pressure.html#subroutine_compute_press_grad">compute_press_grad</A> (p, dpdx, dpdy, dpdz, p_hat)
    private subroutine <A HREF="compute_pressure.html#subroutine_tridiag_solver">tridiag_solver</A> (x, r)
    private subroutine <A HREF="compute_pressure.html#subroutine_tridiag_solver_parallel">tridiag_solver_parallel</A> (x, r)
    private subroutine <A HREF="compute_pressure.html#subroutine_build_wavenumbers">build_wavenumbers</A> ()
    private subroutine <A HREF="compute_pressure.html#subroutine_build_matrix">build_matrix</A> ()

end module compute_pressure
</PRE>
 module: compute pressure
<P>
 <UL>
 <LI>  last modified: fabien margairaz ( fabien.margairaz@gmail.com ), 01/07/2014
<P>
 <LI>  description:
 </UL>

<HR><H2> Description of Variables </H2>
<A NAME="var_dcp"><H3>dcp</H3></A>
<PRE>type (DECOMP_INFO), private, save :: dcp
</PRE>
<A NAME="var_sp"><H3>sp</H3></A>
<PRE>type (DECOMP_INFO), private, save :: sp
</PRE>
<A NAME="var_a"><H3>a</H3></A>
<PRE>real (kind=rprec), private, allocatable, dimension(:,:,:) :: a
</PRE>
<A NAME="var_b"><H3>b</H3></A>
<PRE>real (kind=rprec), private, allocatable, dimension(:,:,:) :: b
</PRE>
<A NAME="var_c"><H3>c</H3></A>
<PRE>real (kind=rprec), private, allocatable, dimension(:,:,:) :: c
</PRE>

<HR><H2> Description of Subroutines and Functions </H2>
<A NAME="subroutine_press_init"><H3>press_init</H3></A>
<PRE>public subroutine press_init (dcp_main)
    type (DECOMP_INFO), intent(in) :: dcp_main
    ! Calls: build_matrix, decomp_2d_abort, decomp_2d_fft_2d_get_sp_info
end subroutine press_init
</PRE>
 subroutine: initialise the pressure module
<P>
 <UL>
 <LI>  last modified: fabien margairaz ( fabien.margairaz@gmail.com ), 23/06/2014
<P>
 <LI>  description:
  <UL>
  <LI>  kkx and kky are in global indexes, size (nx/2+1,ny)
  <LI>  a,b,c upper-,main-,lower-diag of Poisson solver matrix are in local 
    indexes, size (nx/2+1,ny,nz+1)
 </UL>
  </UL>
<A NAME="subroutine_press_finalize"><H3>press_finalize</H3></A>
<PRE>public subroutine press_finalize ()
end subroutine press_finalize
</PRE>
 subroutine: finalise the pressure module
<P>
 <UL>
 <LI>  last modified: fabien margairaz ( fabien.margairaz@gmail.com ), 23/06/2014
<P>
 <LI>  description:
 </UL>
<A NAME="subroutine_press_stag_array"><H3>press_stag_array</H3></A>
<PRE>public subroutine press_stag_array (tadv1)
    real (kind=rprec), intent(IN) :: tadv1
    ! Calls: MPI_BCAST, compute_press_grad, execute_decomp_2d_fft_2d, get_layer_fft_x, poisson_solver, update_ghost
end subroutine press_stag_array
</PRE>
 subroutine: compute the pressure and its gradient
<P>
 <UL>
 <LI>  last modified: fabien margairaz ( fabien.margairaz@gmail.com ), 20/06/2014
<P>
 <LI>  description:
  <UL>
  <LI>  input: tadv1 time adv coeff
  <LI>  global variables: p,dpdx,dpdy on uvp-nodes k=1,...,Nz-1
  <LI>  global variables: dpdz on w-nodes k=1,...,Nz-1
 </UL>
  </UL>
<A NAME="subroutine_poisson_solver"><H3>poisson_solver</H3></A>
<PRE>private subroutine poisson_solver (wk_press, bot_layer, top_layer)
    complex (kind=rprec), dimension(sp%ysz(1),sp%ysz(2),0:sp%ysz(3)+1), intent(INOUT) :: wk_press
    complex (kind=rprec), dimension(nx/2+1,ny), intent(IN) :: bot_layer
    complex (kind=rprec), dimension(nx/2+1,ny), intent(IN) :: top_layer
    ! Calls: transpose_y_to_z, transpose_z_to_y, tridiag_solver_parallel
end subroutine poisson_solver
</PRE>
 subroutine: Poisson solver
<P>
 <UL>
 <LI>  last modified: fabien margairaz ( fabien.margairaz@gmail.com ), 25/06/2014
<P>
 <LI>  description:
  <UL>
  <LI>  input&output in the same variable
  <LI>  input: RHS in Y-pencil
  <LI>  output: p_hat in Y-pencil
 </UL>
  </UL>
<A NAME="subroutine_compute_press_grad"><H3>compute_press_grad</H3></A>
<PRE>private subroutine compute_press_grad (p, dpdx, dpdy, dpdz, p_hat)
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),0:dcp%xsz(3)+1), intent(OUT) :: p
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),dcp%xsz(3)), intent(OUT) :: dpdx
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),dcp%xsz(3)), intent(OUT) :: dpdy
    real (kind=rprec), dimension(dcp%xsz(1),dcp%xsz(2),dcp%xsz(3)), intent(OUT) :: dpdz
    complex (kind=rprec), dimension(sp%ysz(1),sp%ysz(2),0:sp%ysz(3)+1), intent(INOUT) :: p_hat
    ! Calls: execute_decomp_2d_fft_2d, update_ghost
end subroutine compute_press_grad
</PRE>
 subroutine: compute pressure gradient
<P>
 <UL>
 <LI>  last modified: fabien margairaz ( fabien.margairaz@gmail.com ), 20/06/2014
<P>
 <LI>  description:
  <UL>
  <LI>  input: p_hat in Y-pencil
  <LI>  output: p,dpdx,dpdy,dpdz in X-pencil
  <LI>  ghostcell are up-to-date for pressure
  <LI>  no ghostcell for gradient
 </UL>
  </UL>
<A NAME="subroutine_tridiag_solver"><H3>tridiag_solver</H3></A>
<PRE>private subroutine tridiag_solver (x, r)
    complex (kind=rprec), dimension(sp%zsz(1),sp%zsz(2),sp%zsz(3)+2), intent(OUT) :: x
    complex (kind=rprec), dimension(sp%zsz(1),sp%zsz(2),sp%zsz(3)+2), intent(IN) :: r
    ! Calls: decomp_2d_abort
end subroutine tridiag_solver
</PRE>
 subroutine: tridiagonal solver
<P>
 <UL>
 <LI>  last modified: fabien margairaz ( fabien.margairaz@gmail.com ), 24/06/2014
<P>
 <LI>  description:
 </UL>
<A NAME="subroutine_tridiag_solver_parallel"><H3>tridiag_solver_parallel</H3></A>
<PRE>private subroutine tridiag_solver_parallel (x, r)
    complex (kind=rprec), dimension(sp%zsz(1),sp%zsz(2),sp%zsz(3)+2), intent(OUT) :: x
    complex (kind=rprec), dimension(sp%zsz(1),sp%zsz(2),sp%zsz(3)+2), intent(IN) :: r
end subroutine tridiag_solver_parallel
</PRE>
 subroutine: tridiagonal solver in parallel
<P>
 <UL>
 <LI>  last modified: fabien margairaz ( fabien.margairaz@gmail.com ), 02/07/2014
<P>
 <LI>  description:
  <UL>
  <LI>  i,j are independent because of Fourier decomposition
  <LI>  parallelised on j not on i because of memory alignement
 </UL>
  </UL>
<A NAME="subroutine_build_wavenumbers"><H3>build_wavenumbers</H3></A>
<PRE>private subroutine build_wavenumbers ()
end subroutine build_wavenumbers
</PRE>
 subroutine: build wavenumbers arrays in sprectral space
<P>
 <UL>
 <LI>  last modified: fabien margairaz ( fabien.margairaz@gmail.com ), 20/06/2014
<P>
 <LI>  description:
  <UL>
  <LI>  kx&ky in sprectral space
  <LI>  adds at nyquist freq values of kx, ky = 0 for the derivatives  
  <LI>  renormalizes the wavenumbers to take into account the real domain dimention
 </UL>
  </UL>
<A NAME="subroutine_build_matrix"><H3>build_matrix</H3></A>
<PRE>private subroutine build_matrix ()
    ! Calls: decomp_2d_abort
end subroutine build_matrix
</PRE>
 subroutine: build diagonales of Poisson solver matrix
<P>
 <UL>
 <LI>  last modified: fabien margairaz ( fabien.margairaz@gmail.com ), 20/06/2014
<P>
 <LI>  description:
  <UL>
  <LI>  equation (-kx^2-ky^2+dzdz) P = RHS 
 </UL>
  </UL>
</HTML>
